---
title: "Data Munging"
author: ""
date: ""
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = FALSE)
```

## Reading in Data

### Reading in CSV

CSVs are probably one of the most common data formats that you will work with.
To read in data we will use the "readr" package.

```{r read-subway-do}
root <- rprojroot::find_rstudio_root_file()
dataDir <- file.path(root, 'Data')

library(readr)
subway <- read_csv(file=file.path(dataDir, "subway.csv"))
```

How about reading files from online?

```{r read-subway,eval=FALSE}
subway_online <- read_csv(file="http://ml-course.kazsakamoto.com/Data/subway.csv")
```

Let's take a look at what subway loos like

```{r subway-head-show}
head(subway)
```

## Read Excel
Load the package

```{r load-readxl,echo=FALSE}
library(readxl)
```

let's now set the data directory and load the excel file and see the sheets

```{r see-sheets-show, eval=FALSE, warning = FALSE, error=FALSE}
excel_sheets(file.path(dataDir, 'subway.xlsx'))
```

we can load the actual table with the specified sheet.
```{r read-subway-with-readxl-do,eval=FALSE}
subwayXL <- read_excel(file.path(dataDir, 'subway.xlsx'), sheet=1)
```

## Pipes

let's load the library magrittr.

```{r load-magrittr}
library(magrittr)
```
  
pipes are very useful and easier to read. Let's compare viewing the head of the
data with and without pipes.
```{r head}
head(subway)
subway %>% head
```
what if we wanted to get only the top four observations? let's add n = 4 as an argument.

```{r}
head(subway, n=4)
subway %>% head(n=4)
```


What if we wanted to get just the fourth row?

```{r head-tail}
tail(head(iris, n=4), n=1)
iris %>% head(n=4) %>% tail(n=1)
```

## Dplyr

### select

If we need to select ceration columns from our table there are a few ways to do it
in dplyr we use select
```{r dplyr-select}
subway[, c('Lat', 'Long')]
subway %>% select(Lat, Long)

subway %>% select(5, 6)
# everything but carat and price
subway %>% select(-c(5, 6))
```

### filter

if we want to apply certain filters to our data, we can use filter to add
logical arguments
```{r dplyr-filter}
subway[subway$LINE == 'SIR', ]
subway %>% filter(LINE == 'SIR')
# and
subway %>% filter(LINE == 'SIR', Long < -74.18)
# and
subway %>% filter(LINE == 'SIR' & Long < -74.18)
# or
subway %>% filter(LINE == 'SIR' | Long < -74.18)
# or
subway %>% filter(LINE %in% c('SIR', '6'))
```

### slice

If we want to select rows by index numbers, we can use slice
```{r dplyr-slice}
subway %>% slice(1:5)
subway %>% slice(1:10)
```


### mutate 

If you want to create a new column use the mutate function

```{r dplyr-mutate}
# price/carat
subway %>% mutate(pass / stairs)
subway %>% mutate(ratio = pass / stairs)

# write back to original data.frame
subway %<>% mutate(ratio = pass / stairs)
subway
```
 We can even include more than one column to be made
```{r dplyr-mutate-seq}
subway %>% mutate(passLog = log(pass), TwiceSize = ratio * 2)
```

### summarize

what if we want to make sume summary stats?
```{r dplyr-sumamrize}

subway %>% summarize(mean(pass))
subway %>% summarize(AvgPass = mean(pass))
```

### group_by 
like pivot tables, maybe you want to group your data?
```{r dplyr-group-by}
subway %>% group_by(borough) %>% summarize(AvgPass=mean(pass))
subway %>% group_by(borough, stairs) %>% summarize(AvgPass=mean(pass))
```

how about multiple summaries?
```{r dplyr-group-by-mult}
subway %>% group_by(borough) %>% summarize(AvgPass=mean(pass), AvgStairs=mean(stairs), TotalPass=sum(pass))
subway %>% group_by(borough, stairs) %>% summarize(AvgPass=mean(pass), Count = n(), TotalPass=sum(pass)) -> subwayWide
subwayWide
```

### gather
```{r}
subwayWide %>% gather(key = variable, value = value, -borough, - stairs) -> subwayLong
subwayLong
```


### spread
```{r}
subwayLong %>% spread(key = variable, value = value)
```


### unite
```{r}
subway %>% unite(Coord, Lat, Long, sep = " ") -> subwayCoord
```

### separate
```{r}
subwayCoord %>% separate(Coord, c("Lat", "Long"), sep = " ")
```

### arrange

```{r}
subway %>% arrange(pass)
subway %>% arrange(desc(pass))
subway %>% arrange(desc(pass), desc(stairs))
```

## Function Arguments
```{r multiplying-funcs}
timesTwo <- function(x)
{
    return(x * 2)
}
timesTwo(3)

timesTwo <- function(x)
{
    x * 2
}
timesTwo(3)

timesX <- function(n, x)
{
    n * x
}
timesX(4,7)

timesX <- function(n, x=2)
{
    n * x
}

timesX(4, 7)
timesX(4)
```
